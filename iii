#!/bin/bash

: "${c:=#foss-aueb}"        # channel
: "${n:=irc.freenode.net}"  # network
: "${p:=/tmp/irc}"          # root dir

blk="$(tput setaf 6)"       # cyan    \003[36m
grn="$(tput setaf 2)"       # green   \003[31m
nor="$(tput sgr0)"          # normal  \003[0m -- reset

[[ -e "$p/$n/$c/out" && -e "$p/$n/$c/in" ]] || exit 1

tailf "$p/$n/$c/out" | while read -r date time nick msg
do printf -- "$blk%s $grn%15s $blk| $nor%s\n" "$date $time" "${nick}" "$msg"
done &

trap 'kill -TERM -0' EXIT

while read -r; do
    [[ "$REPLY" == "QUIT" ]] && break
    tput cuu1 # do not echo read's input
    printf -- "%s\n" "$REPLY" >"$p/$n/$c/in"
done

